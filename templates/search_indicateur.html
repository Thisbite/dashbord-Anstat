<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Requête sur indicateur</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/search_indicateur.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="header-title">
    <h1>
      <img src="{{ url_for('static', filename='img/logo.jpeg') }}" alt="Logo" class="logo">
      Plateforme de données régionales
    </h1>
  </div>
  <div class="header-secondary">
    <!-- Bouton Hamburger (visible uniquement sur mobile) -->
    <div class="hamburger">
      <i class="fas fa-bars"></i>
    </div>

    <!-- Menu de navigation -->
    <div class="nav-links" id="nav-links">
      <a href="{{ url_for('list_regions') }}" class="logo-link">
        <img src="{{ url_for('static', filename='img/logo2.png') }}" alt="Statistiques" style="width: 50px; height: auto;">
      </a>
      <a href="{{ url_for('search_indicators') }}">Accéder aux indicateurs</a>
      <a href="{{ url_for('api') }}">Demande API</a>
    </div>

    <!-- Barre de recherche -->
    <div class="search-bar">
      <form method="POST" action="{{ url_for('search') }}" onsubmit="return submitSearch();">
        <input type="text" id="search-input" name="query" placeholder="Entrez votre recherche..." required autocomplete="off">
        <div id="suggestions" class="suggestions-list"></div>
        <button type="submit" id="search-button">Rechercher</button>
      </form>
    </div>
  </div>

  <!-- Fenêtre modale pour la description -->
  <div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="descriptionModalLabel">
            <i class="fas fa-info-circle" style="color: #e76f51; margin-right: 10px;"></i> Description de la base de données
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Cette base de données a été développée afin de mettre à la disposition des utilisateurs et des usagers un moyen efficace pour accéder aux données statistiques régionales désagrégées.</p>
          <p>Elle est composée autant des données produites par les structures du système statistique national que de celles issues des enquêtes d'envergure réalisées par l'Agence Nationale de la Statistique (ANStat).</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Nouvelle section -->
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-4 sidebar">
        <h5>Domaines</h5>
        <ul id="domaines" class="list-group"></ul>
      </div>
      <div class="col-md-4 main-content">
        <h5>Sous-domaines</h5>
        <ul id="thematiques" class="list-group"></ul>
      </div>
      <div class="col-md-4 indicators-list main-content">
        <h5>Indicateurs</h5>
        <div class="input-group mb-3">
          <input type="text" id="indicatorSearch" class="form-control" placeholder="Saisir mot clé...">
          <button class="btn btn-outline-secondary" type="button" id="clearSearch">Effacer</button>
        </div>
        <ul id="indicateurs" class="list-group"></ul>
      </div>
    </div>
  </div>

  <!-- Section d'informations sur le domaine -->
  <div class="container mt-4">
    <div class="row">
      <div class="col-md-12">
        <button id="btn-en-savoir-plus" class="btn btn-primary" style="display: none;">
          Informations sur le domaine
        </button>
        <div id="domaine-info" class="mt-3" style="display: none;">
          <p id="domaine-description"></p>
        </div>
      </div>
    </div>
  </div>

     <!-- Pied de page ajouté -->
     <footer class="footer">
      <div class="footer-content">
          <div class="footer-section">
              <h3>À propos</h3>
              <p>Plateforme de données régionales développée par <a href="https://www.anstat.ci/" target="_blank">ANSTAT</a>. Toutes les données sont basées sur les projections RGPH 2021.</p>
          </div>
          <div class="footer-section">
              <h3>Liens utiles</h3>
              <ul>
                  <li><a href="{{ url_for('list_regions') }}">Liste des régions</a></li>
                  <li><a href="{{ url_for('search_indicators') }}">Indicateurs</a></li>
                  <li><a href="#">Contactez-nous</a></li>
              </ul>
          </div>
          <div class="footer-section">
              <h3>Suivez-nous</h3>
              <div class="social-links">
                  <a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a>
                  <a href="#" target="_blank"><i class="fab fa-twitter"></i></a>
                  <a href="#" target="_blank"><i class="fab fa-linkedin-in"></i></a>
              </div>
          </div>
      </div>
      <div class="footer-bottom">
          <p>&copy; 2025 ANSTAT - Tous droits réservés</p>
      </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const hamburger = document.querySelector(".hamburger");
      const navLinks = document.querySelector("#nav-links");

      hamburger.addEventListener("click", function () {
        navLinks.classList.toggle("active");
      });

      document.addEventListener("click", function (event) {
        if (!hamburger.contains(event.target) && !navLinks.contains(event.target)) {
          navLinks.classList.remove("active");
        }
      });

      const descriptionModal = new bootstrap.Modal(document.getElementById('descriptionModal'));
      descriptionModal.show();

      descriptionModal._element.addEventListener('hidden.bs.modal', function () {
        const backdrop = document.querySelector('.modal-backdrop');
        if (backdrop) backdrop.remove();
      });

      fetchData();

      const indicatorSearch = document.getElementById('indicatorSearch');
      const clearSearchBtn = document.getElementById('clearSearch');
      const indicateursList = document.getElementById('indicateurs');

      indicatorSearch.addEventListener('input', function () {
        const query = this.value.toLowerCase().trim();
        filterIndicators(query);
      });

      clearSearchBtn.addEventListener('click', function () {
        indicatorSearch.value = '';
        filterIndicators('');
      });

      function filterIndicators(query) {
        const indicatorItems = indicateursList.getElementsByClassName('list-group-item');
        for (let item of indicatorItems) {
          const indicatorText = item.textContent.toLowerCase();
          if (indicatorText.includes(query)) {
            item.classList.remove('hidden');
          } else {
            item.classList.add('hidden');
          }
        }
      }

      const searchInput = document.getElementById("search-input");
      const suggestionsContainer = document.getElementById("suggestions");

      searchInput.addEventListener("input", function () {
        const query = searchInput.value.trim();
        if (query.length < 2) {
          suggestionsContainer.innerHTML = "";
          return;
        }

        fetch(`/autocomplete?query=${encodeURIComponent(query)}`)
          .then(response => response.json())
          .then(data => {
            suggestionsContainer.innerHTML = "";
            if (data.length > 0) {
              data.forEach(item => {
                const div = document.createElement("div");
                div.textContent = item;
                div.onclick = function () {
                  searchInput.value = item;
                  suggestionsContainer.innerHTML = "";
                  window.location.href = `/search_indicators2/${encodeURIComponent(item)}`;
                };
                suggestionsContainer.appendChild(div);
              });
            }
          });
      });

      document.addEventListener("click", function (event) {
        if (!searchInput.contains(event.target) && !suggestionsContainer.contains(event.target)) {
          suggestionsContainer.innerHTML = "";
        }
      });
    });

    let domaines = {};
    function fetchData() {
      fetch('/get_data2')
        .then(response => response.json())
        .then(data => {
          Object.keys(data).forEach(key => {
            const [domaine, thematique] = key.split(', ');
            if (!domaines[domaine]) {
              domaines[domaine] = { thematiques: {} };
            }
            domaines[domaine].thematiques[thematique] = data[key];
          });
          displayDomaines();
          const firstDomaine = Object.keys(domaines)[0];
          if (firstDomaine) selectDomaine(firstDomaine);
        })
        .catch(error => console.error('Erreur lors de la récupération des données:', error));
    }

    function displayDomaines() {
      const domainesList = document.getElementById('domaines');
      domainesList.innerHTML = '';
      Object.keys(domaines).forEach(domaine => {
        const li = document.createElement('li');
        li.classList.add('list-group-item');
        li.onclick = function () { selectDomaine(domaine); };
        li.innerHTML = `<i class="fas fa-folder"></i> ${domaine.charAt(0).toUpperCase() + domaine.slice(1).replace(/_/g, ' ')}`;
        domainesList.appendChild(li);
      });
    }

    function selectDomaine(domaine) {
      const domainesList = document.getElementById('domaines');
      const allDomaines = domainesList.querySelectorAll('li');
      allDomaines.forEach(li => li.classList.remove('active'));
      const selectedDomaine = Array.from(allDomaines).find(li => 
        li.textContent.trim().toLowerCase() === domaine.toLowerCase()
      );
      if (selectedDomaine) selectedDomaine.classList.add('active');

      const btnEnSavoirPlus = document.getElementById('btn-en-savoir-plus');
      btnEnSavoirPlus.style.display = 'block';
      btnEnSavoirPlus.onclick = function () { afficherInfosDomaine(domaine); };
      afficherInfosDomaine(domaine);

      const thematiquesList = document.getElementById('thematiques');
      const indicateursList = document.getElementById('indicateurs');
      thematiquesList.innerHTML = '';
      indicateursList.innerHTML = '';

      if (!domaines[domaine]) return;

      Object.keys(domaines[domaine].thematiques).forEach(thematique => {
        const li = document.createElement('li');
        li.classList.add('list-group-item');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.classList.add('form-check-input');
        checkbox.id = thematique;
        checkbox.onchange = function () { toggleIndicateurs(domaine, thematique, checkbox.checked); };
        const label = document.createElement('label');
        label.classList.add('checkbox-label');
        label.setAttribute('for', thematique);
        label.innerHTML = thematique.charAt(0).toUpperCase() + thematique.slice(1);

        li.appendChild(checkbox);
        li.appendChild(label);
        thematiquesList.appendChild(li);
      });
    }

    function toggleIndicateurs(domaine, thematique, isChecked) {
      const indicateursList = document.getElementById('indicateurs');
      if (isChecked) {
        domaines[domaine].thematiques[thematique].forEach(indicateur => {
          const li = document.createElement('li');
          li.classList.add('list-group-item');
          li.id = `indicateur-${indicateur.replace(/\s+/g, '-')}`;
          const a = document.createElement('a');
          a.href = `#`;
          a.innerHTML = indicateur;
          a.classList.add('indicateur-link');
          a.onclick = function (event) {
            event.preventDefault();
            searchIndicatorInElastic(indicateur);
          };
          li.appendChild(a);
          indicateursList.appendChild(li);

          const currentQuery = document.getElementById('indicatorSearch').value.toLowerCase().trim();
          if (currentQuery && !indicateur.toLowerCase().includes(currentQuery)) {
            li.classList.add('hidden');
          }
        });
      } else {
        domaines[domaine].thematiques[thematique].forEach(indicateur => {
          const li = document.getElementById(`indicateur-${indicateur.replace(/\s+/g, '-')}`);
          if (li) indicateursList.removeChild(li);
        });
      }
    }

    function searchIndicatorInElastic(indicateur) {
      const encodedIndicateur = encodeURIComponent(indicateur);
      window.location.href = `/search_indicators2/${encodedIndicateur}`;
    }

    const descriptionsDomaines = {
      "Population": "Le domaine de la population couvre les statistiques relatives à l'état et structure de la population; la dynamique de la population (mariages, divorces, taille des ménages) ; les perspectives démographiques.",
      "Agriculture": "Le domaine de l'agriculture couvre les statistiques relatives à la production végétale; la production forestière et chasse; la production animale et halieutique; l'aménagement rural.",
      "Condition de vie des ménages": "Le domaine de la condition de vie des ménages couvre les statistiques permettant d'évaluer le bien-être économique et social des populations : éducation; santé; emploi par grands domaines; logement; revenu, consommation, budget; protection sociale; culture et loisirs.",
      "Entreprises non Agricoles": "Le domaine des entreprises non agricoles couvre les statistiques relatives aux bâtiments et travaux Publics; mines et industries; commerce et services; eau et électricité; transports; poste et télécoms; tourisme et artisanat.",
      "Environnement": "Le domaine de l'environnement couvre les statistiques relatives aux ressources naturelles et biodiversité; établissements humains; catastrophes naturelles et risque.",
      "Gouvernance": "Le domaine de la gouvernance couvre les statistiques relatives au statistique politique; Economique; Sociale; Judiciaire; Institutionnelle; Participative.",
      "Grands Equilibres Economiques": "Le domaine des grands équilibres économiques couvre les statistiques relatives au secteur réel (PIB, Exportations et importations de biens et services physiques); Monnaie et crédit; aux échanges extérieurs; Finances publiques."
    };

    function afficherInfosDomaine(domaine) {
      const domaineInfo = document.getElementById('domaine-info');
      const domaineDescription = document.getElementById('domaine-description');
      domaineDescription.textContent = descriptionsDomaines[domaine] || "Aucune description disponible pour ce domaine.";
      domaineInfo.style.display = 'block';
    }
  </script>
</body>
</html>