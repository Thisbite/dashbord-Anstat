<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte des Populations avec D3.js</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        .region {
            stroke: black;
            stroke-width: 1;
        }
        .tooltip {
            position: absolute;
            background-color: white;
            padding: 5px;
            border: 1px solid black;
            border-radius: 5px;
            pointer-events: none;
            font-size: 12px;
        }
        .legend {
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="tooltip" class="tooltip" style="display: none;"></div>

    <script>
        // Dimensions de la carte
        const width = 800, height = 600;

        // Créer une projection géographique pour la Côte d'Ivoire
        const projection = d3.geoMercator()
            .center([-5.547080, 7.539989])  // Centre sur la Côte d'Ivoire
            .scale(4000)
            .translate([width / 2, height / 2]);

        // Générateur de chemins pour les polygones
        const path = d3.geoPath().projection(projection);

        // Couleurs pour l'échelle de population
        const colorScale = d3.scaleLinear()
            .domain([100000, 5000000])  // Mettre ici les min et max populations
            .range(["yellow", "green"]);

        // Ajouter un SVG pour la carte
        const svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Ajouter le conteneur de la légende
        const legend = svg.append("g")
            .attr("class", "legend")
            .attr("transform", "translate(20, 20)");

        // Charger les données GeoJSON
        d3.json("static/carte/populations_ok.json").then(function(geojsonData) {

            // Dessiner les régions
            svg.selectAll(".region")
                .data(geojsonData.features)
                .enter().append("path")
                .attr("class", "region")
                .attr("d", path)
                .attr("fill", d => colorScale(d.properties.Population))
                .on("mouseover", function(event, d) {
                    // Afficher la population en survolant
                    d3.select("#tooltip")
                        .style("display", "block")
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px")
                        .html(`<strong>${d.properties.REGION}</strong><br>Population: ${d.properties.Population}`);
                })
                .on("mouseout", function() {
                    // Masquer le tooltip
                    d3.select("#tooltip").style("display", "none");
                });

            // Ajouter une légende pour l'échelle des couleurs
            const legendScale = d3.scaleLinear()
                .domain([100000, 5000000])
                .range([0, 300]);

            const legendAxis = d3.axisBottom(legendScale)
                .ticks(5)
                .tickFormat(d3.format(".0s"));

            const gradient = svg.append("defs")
                .append("linearGradient")
                .attr("id", "gradient")
                .attr("x1", "0%").attr("y1", "0%")
                .attr("x2", "100%").attr("y2", "0%");

            gradient.append("stop").attr("offset", "0%").attr("stop-color", "yellow");
            gradient.append("stop").attr("offset", "100%").attr("stop-color", "green");

            legend.append("rect")
                .attr("width", 300)
                .attr("height", 10)
                .style("fill", "url(#gradient)");

            legend.append("g")
                .attr("transform", "translate(0, 10)")
                .call(legendAxis);
        });
    </script>
</body>
</html>
